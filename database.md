# 关于数据库的一些想法  

> 这里引《亮剑》里`山本一木`一句台词：`我没这么大胃口吃掉他一个团，但吃掉他的指挥部我还是很有兴趣的。`  

## 利用C语言实现数据文件的思路  

### 文件I/O  

是较为耗时的操作。所以应当尽量减少，而持久化存储又不能缺少。  

> - 缓存：经常使用的表常驻内存  
> - 减少`write`：[文件存储](#存储)  
> - 分段`read`：`fopen()` 只是打开文件，生成一个文件描述符；真正的读取且大量耗时操作在`fread()`，所以可以提前根据一些规则定位要读取的数据，比如索引  

### 索引  

索引一般采用`b+`树，遍历元素时只需遍历以便叶子节点就好了  

> - 重建索引时需要一并更改行号等信息  
> - 对于字符串匹配可以采用`KMP` 算法  
> - 定长字符串可以通过`散列表` 建立索引  

### 存储  

**文件中不能安全存储指针**，必须要有一些格式要求来支持上面的要求  

> - 不定长度的数据(字符串)：似乎只能走遍历的情况了，以`\0` 结尾，还是指定长度  
>
>> - 采取指定长度的话可以减少一部分文件重新写入的操作(新串短于旧串)  
>> - ⚠：如何合理地确定字符串？
>
> - 固定长度的数据：可以直接顺序存储在一块，用一个单向链表表明具体意义  
> - 删除记录时采用`软删除`，因为只写删除需要重写文件并**更新索引**  
> - 修改数据时也是逐项修改效率要高一些  

### 注意  

- C 语言中`内存连续`的数据可以只调用一次写入方法完成，链表这种不连续的数据则需要逐个写入  
- 单机考虑，数据库效率肯定不如直接文件操作高效，但是数据库的功能更为强大和完善，小程序可以考虑自己实现  

